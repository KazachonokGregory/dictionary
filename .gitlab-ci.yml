stages:
  - build
  - test

BuildCode:
  stage: build
  script:
    - mkdir -p build
    - cd build
    - cmake ..
    - make
    - make coverage
    - cmake --install . --prefix ../dist
    - cd ..
    - ls
  artifacts:
    paths:
      - dist/exe
      - bin
      - lib
      - build/coverage.xml

TestCode:
  variables:
    GTEST_OUTPUT: "xml:report.xml"
  stage: test
  script:
    - ./bin/Tests
  coverage: '/^TOTAL.*\s+(\d+\%)$/'
  artifacts:
    paths:
      - report.xml
    reports:
      junit: report.xml
      coverage_report: 
        coverage_format: cobertura
        path: build/coverage.xml
